# Tasks Document

- [ ] 1. Add ContentWidth/ContentHeight fields to PanelDimensions
  - File: cmd/tui/components/layout_manager.go
  - Add ContentWidth and ContentHeight int fields to PanelDimensions struct
  - Purpose: Store both total allocated dimensions and content dimensions after frame overhead
  - _Leverage: Existing PanelDimensions struct, lipgloss.Style.GetFrameSize() methods_
  - _Requirements: 3.1 (Layout Manager Enhancement acceptance criteria 1)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go developer with expertise in layout systems | Task: Add ContentWidth and ContentHeight int fields to the PanelDimensions struct in cmd/tui/components/layout_manager.go following requirement 3.1. Add inline comments explaining: "ContentWidth is Width minus horizontal frame size (border + padding)" and "ContentHeight is Height minus vertical frame size (border + padding)" | Restrictions: Do not modify existing X, Y, Width, Height fields, do not change any calculation logic yet (that's next task), only add new fields to struct | Success: PanelDimensions struct compiles with new fields, inline documentation added, existing code unaffected | Instructions: After completing this task, update tasks.md to mark task 1 as complete [x] and mark task 2 as in-progress [-]_

- [ ] 2. Calculate content dimensions in LayoutManager.Calculate()
  - File: cmd/tui/components/layout_manager.go (continue from task 1)
  - Use GetFrameSize() methods to populate ContentWidth/ContentHeight for each panel
  - Import cmd/tui/styles package to access border styles
  - Purpose: Provide frame-aware dimensions from layout manager using Lipgloss built-in methods
  - _Leverage: styles.ActivePanelBorderStyle, lipgloss.Style.GetHorizontalFrameSize(), GetVerticalFrameSize()_
  - _Requirements: 2.1-2.5 (Use Lipgloss Built-in Frame Size Methods), 3.1-3.3 (Layout Manager Enhancement)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go developer specializing in Lipgloss and layout calculations | Task: In LayoutManager.Calculate() method in cmd/tui/components/layout_manager.go, after calculating Width/Height for each PanelDimensions (lines 167-287), add code to calculate ContentWidth/ContentHeight using Lipgloss GetFrameSize() methods following requirements 2.1-2.5 and 3.1-3.3. For bordered panels (Sidebar, Main, Metadata): Call styles.ActivePanelBorderStyle.GetHorizontalFrameSize() and GetVerticalFrameSize(), then set ContentWidth = Width - horizontalFrameSize and ContentHeight = Height - verticalFrameSize. For non-bordered panels (StatusBar, Process, CommandBar): Set ContentWidth = Width and ContentHeight = Height (no frame overhead). Add import "pass-cli/cmd/tui/styles" at top of file | Restrictions: Do not change existing Width/Height calculations, do not modify breakpoint logic, preserve all existing layout behavior, only ADD content dimension calculations after Width/Height are set | Success: All PanelDimensions have ContentWidth/ContentHeight populated correctly, bordered panels use GetFrameSize() methods, non-bordered panels have content dimensions equal to total dimensions, code compiles without errors | Instructions: After completing this task, update tasks.md to mark task 2 as complete [x] and mark task 3 as in-progress [-]_

- [ ] 3. Remove hardcoded border overhead constants from renderDashboardView()
  - File: cmd/tui/helpers.go
  - Delete const borderWidth = 4 and borderHeight = 2 constants (lines 211-212)
  - Remove all manual border overhead subtraction (lines 220-271)
  - Purpose: Eliminate hardcoded magic numbers and prepare for GetFrameSize() usage
  - _Leverage: Enhanced Layout from task 2 with ContentWidth/ContentHeight_
  - _Requirements: 2.5 (zero hardcoded border overhead constants), 5.1 (Clear Documentation)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go refactoring specialist | Task: Refactor renderDashboardView() in cmd/tui/helpers.go following requirements 2.5 and 5.1 by removing hardcoded border overhead constants. Changes: 1) Delete lines 211-212 (const borderWidth = 4, const borderHeight = 2), 2) Remove all manual overhead subtraction in lines 220-271 where we calculate mainPanelWidth = layout.Main.Width - borderWidth (and similar for sidebar/metadata), 3) For now, use style.Width(layout.Panel.Width).Height(layout.Panel.Height) WITHOUT subtracting anything - we'll fix the dimensions in the next task using ContentWidth/ContentHeight | Restrictions: Do not change lipgloss.JoinHorizontal/JoinVertical logic, do not change focus state logic, ensure code still compiles (it will render incorrectly but that's expected - next task fixes it) | Success: No hardcoded borderWidth/borderHeight constants remain, no manual subtraction of 4 or 2 from dimensions, code compiles without errors | Instructions: After completing this task, update tasks.md to mark task 3 as complete [x] and mark task 4 as in-progress [-]_

- [ ] 4. Use GetFrameSize() for correct dimension calculation in renderDashboardView()
  - File: cmd/tui/helpers.go (continue from task 3)
  - Calculate content width/height using GetFrameSize() before applying styles
  - Use ContentWidth/ContentHeight from layout for component SetSize() calls
  - Purpose: Correctly size bordered panels using Lipgloss's built-in frame size methods
  - _Leverage: styles.ActivePanelBorderStyle.GetFrameSize(), enhanced Layout with ContentWidth/ContentHeight_
  - _Requirements: 1.4-1.5 (Systematic Border Overhead Calculation), 2.1-2.3 (Use Lipgloss Built-in)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go developer with Lipgloss expertise | Task: Fix panel sizing in renderDashboardView() in cmd/tui/helpers.go following requirements 1.4-1.5 and 2.1-2.3 using GetFrameSize() methods. For each bordered panel (sidebar lines 234-250, main lines 214-228, metadata lines 257-273): 1) Get the appropriate style (activeStyle or inactiveStyle based on focus), 2) Call horizontalFrame := style.GetHorizontalFrameSize() and verticalFrame := style.GetVerticalFrameSize(), 3) Calculate contentWidth = layout.Panel.Width - horizontalFrame and contentHeight = layout.Panel.Height - verticalFrame, 4) Apply style with .Width(contentWidth).Height(contentHeight).Render(content). ALSO update component SetSize() calls (lines 133-148) to use layout.Panel.ContentWidth and layout.Panel.ContentHeight instead of layout.Panel.Width and layout.Panel.Height. Add comment explaining: "// Lipgloss .Width(n) adds frame on top, so we subtract frame size first" | Restrictions: Must calculate frame size for each panel's actual style (active vs inactive), do not use hardcoded values, preserve all other rendering logic | Success: Panels render with correct dimensions (total rendered size equals allocated layout dimensions), GetFrameSize() used for all bordered panels, components receive ContentWidth/ContentHeight for sizing, code compiles and renders correctly | Instructions: After completing this task, update tasks.md to mark task 4 as complete [x] and mark task 5 as in-progress [-]_

- [ ] 5. Add comprehensive unit tests for GetFrameSize() usage
  - File: cmd/tui/components/layout_manager_test.go
  - Test that GetFrameSize() returns correct values for border styles
  - Test ContentWidth/ContentHeight calculations in layout manager
  - Purpose: Verify frame-aware dimension calculations work correctly
  - _Leverage: testing package, styles.ActivePanelBorderStyle/InactivePanelBorderStyle_
  - _Requirements: 4.1 (Comprehensive Layout Testing acceptance criteria 1-3)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go test engineer specializing in layout testing | Task: Add comprehensive tests to cmd/tui/components/layout_manager_test.go following requirement 4.1 with these test cases using table-driven test pattern: 1) TestGetFrameSizeValues: Call GetHorizontalFrameSize() and GetVerticalFrameSize() on styles.ActivePanelBorderStyle and styles.InactivePanelBorderStyle, assert both return horizontalSize=4 and verticalSize=2 (RoundedBorder=2 + Padding(0,1)=2 horizontal, RoundedBorder=2 + no vertical padding=2), 2) TestLayoutContentDimensions: For each breakpoint (Small, Medium, Full) and each panel visibility config (sidebar only, metadata only, both, neither), call Calculate() and verify for bordered panels: ContentWidth = Width - 4 and ContentHeight = Height - 2, for non-bordered: ContentWidth = Width and ContentHeight = Height, 3) TestLayoutTotalDimensionsPreserved: Verify sum of panel widths still equals terminal width (existing behavior unchanged), 4) TestBreakpointContentDimensions: Test width 79→80 and 119→120 transitions, verify content dimensions correct at both breakpoints | Restrictions: Use table-driven tests, test all breakpoints and visibility combinations, do not hardcode frame size expectations (call GetFrameSize() in test to get expected values) | Success: All tests pass, GetFrameSize() values verified, content dimensions correct for all panels and breakpoints, total dimensions preserved | Instructions: After completing this task, update tasks.md to mark task 5 as complete [x] and mark task 6 as in-progress [-]_

- [ ] 6. Add integration tests for dashboard rendering
  - File: cmd/tui/helpers_test.go
  - Test renderDashboardView() produces output within terminal bounds
  - Test that all borders are visible in rendered output
  - Purpose: Verify complete dashboard renders correctly with proper border sizing
  - _Leverage: components.LayoutManager with ContentWidth/ContentHeight, lipgloss.Width/Height helpers_
  - _Requirements: 4.2 (Integration Testing acceptance criteria 1-3)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go integration test specialist | Task: Create integration tests in cmd/tui/helpers_test.go following requirement 4.2 with test cases: 1) TestDashboardWithinBounds: Create minimal Model with terminal sizes (100x30, 80x24, 120x40), call renderDashboardView(), measure output with lipgloss.Width() and lipgloss.Height(), assert output width ≤ terminal width and output height ≤ terminal height, scan output for border characters (─, │, ╭, ╮, ╰, ╯) to verify borders present, 2) TestPanelVisibilityBorders: Test with different PanelStates (sidebar visible/hidden, metadata visible/hidden), count vertical border characters in output (│), verify correct number of borders for panel config, 3) TestFocusDimensionsUnchanged: Set m.panelFocus to Sidebar/Main/Metadata, render each, verify lipgloss.Width() and Height() of output unchanged (only colors change). Create helper function createTestModel(width, height int, states PanelStates) *Model to simplify test setup | Restrictions: Create minimal Model for testing, mock vault service if needed, measure actual rendered output not internal state, tests must be deterministic | Success: Integration tests pass, dashboard renders within bounds for all terminal sizes, borders visible and correctly positioned, panel toggles and focus changes work without size issues | Instructions: After completing this task, update tasks.md to mark task 6 as complete [x] and mark task 7 as in-progress [-]_

- [ ] 7. Add documentation for Lipgloss GetFrameSize() usage
  - Files: cmd/tui/helpers.go, cmd/tui/components/layout_manager.go
  - Add inline comments explaining GetFrameSize() behavior and usage
  - Document why we subtract frame size before applying Width/Height
  - Purpose: Ensure future developers understand the Lipgloss sizing model
  - _Leverage: Go documentation standards, existing inline comments_
  - _Requirements: 5.1-5.5 (Clear Documentation and Constants acceptance criteria)_
  - _Prompt: Implement the task for spec tui-layout-system, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical writer and Go developer | Task: Add comprehensive documentation following requirements 5.1-5.5 to: 1) cmd/tui/helpers.go - Add function-level comment for renderDashboardView() explaining: "renderDashboardView renders the multi-panel dashboard. Panels use Lipgloss GetFrameSize() to calculate border/padding overhead. IMPORTANT: Lipgloss .Width(n) sets content width and adds frame ON TOP, so we subtract GetHorizontalFrameSize() before applying .Width() to ensure total rendered width equals allocated layout width." Also add inline comments at each GetFrameSize() call site explaining: "// Get frame overhead (border + padding) to calculate content dimensions", 2) cmd/tui/components/layout_manager.go - Add comment to PanelDimensions fields: "ContentWidth is Width minus horizontal frame size (border + padding from style.GetHorizontalFrameSize())" and similar for ContentHeight, add comment in Calculate() where ContentWidth/Height are set: "// Calculate content dimensions using Lipgloss GetFrameSize() to account for border/padding overhead" | Restrictions: Follow Go doc comment conventions, keep comments concise, ensure accuracy with Lipgloss behavior, place comments where they'll be most helpful | Success: All key usage points have documentation, Lipgloss sizing behavior explained clearly, future developers can understand frame size calculation from comments | Instructions: After completing this task, update tasks.md to mark task 7 as complete [x]_
